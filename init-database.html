<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h1>
            <p class="text-xl text-white/90">Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</p>
        </div>

        <div class="max-w-4xl mx-auto">
            <!-- Firebase Configuration -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6 card-hover">
                <div class="flex items-center mb-4">
                    <i class="fas fa-cog text-2xl text-blue-600 ml-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                        <input type="text" id="apiKey" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø§Ø¯Ø®Ù„ API Key">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Auth Domain</label>
                        <input type="text" id="authDomain" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø§Ø¯Ø®Ù„ Auth Domain">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Database URL</label>
                        <input type="text" id="databaseURL" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø§Ø¯Ø®Ù„ Database URL">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project ID</label>
                        <input type="text" id="projectId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø§Ø¯Ø®Ù„ Project ID">
                    </div>
                </div>
            </div>

            <!-- System Settings -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6 card-hover">
                <div class="flex items-center mb-4">
                    <i class="fas fa-building text-2xl text-green-600 ml-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²</label>
                        <input type="text" id="centerName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§Ø´Ø§Øª</label>
                        <input type="number" id="screenCount" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="5" min="1" max="10">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø´Ø§Ø´Ø§Øª</label>
                        <input type="text" id="screenPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="screen123">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØªØ­ÙƒÙ…</label>
                        <input type="text" id="controlPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="control123">
                    </div>
                </div>
            </div>

            <!-- Default Clinics -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6 card-hover">
                <div class="flex items-center mb-4">
                    <i class="fas fa-hospital text-2xl text-red-600 ml-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</h2>
                </div>
                <div id="clinicsList" class="space-y-3">
                    <!-- Clinics will be added here -->
                </div>
                <button onclick="addClinic()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                    <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 justify-center">
                <button onclick="initializeDatabase()" class="bg-green-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-700 transition-colors">
                    <i class="fas fa-database ml-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="downloadConfig()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition-colors">
                    <i class="fas fa-download ml-2"></i>ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
            </div>

            <!-- Progress Section -->
            <div id="progressSection" class="bg-white rounded-lg shadow-lg p-6 mt-6 hidden">
                <div class="flex items-center mb-4">
                    <i class="fas fa-spinner fa-spin text-2xl text-blue-600 ml-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...</h2>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                    <div id="progressBar" class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div id="progressText" class="text-center text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯...</div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="bg-white rounded-lg shadow-lg p-6 mt-6 hidden">
                <div class="flex items-center mb-4">
                    <i class="fas fa-check-circle text-2xl text-green-600 ml-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­</h2>
                </div>
                <div id="resultsContent" class="space-y-2 text-gray-700">
                    <!-- Results will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getFirestore, collection, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let app, auth, database, firestore;
        let defaultClinics = [
            { name: "Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©", number: 1 },
            { name: "Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø·Ù†Ø©", number: 2 },
            { name: "Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„", number: 3 },
            { name: "Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø³Ø§Ø¡", number: 4 },
            { name: "Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©", number: 5 }
        ];

        // Initialize clinics list
        function initializeClinics() {
            const clinicsList = document.getElementById('clinicsList');
            clinicsList.innerHTML = '';
            defaultClinics.forEach((clinic, index) => {
                addClinicToDOM(clinic, index);
            });
        }

        function addClinicToDOM(clinic, index) {
            const clinicDiv = document.createElement('div');
            clinicDiv.className = 'flex gap-3 items-center p-3 border rounded-lg';
            clinicDiv.innerHTML = `
                <input type="text" value="${clinic.name}" class="flex-1 px-3 py-2 border rounded-md" onchange="updateClinic(${index}, 'name', this.value)">
                <input type="number" value="${clinic.number}" class="w-20 px-3 py-2 border rounded-md" onchange="updateClinic(${index}, 'number', this.value)">
                <button onclick="removeClinic(${index})" class="bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            document.getElementById('clinicsList').appendChild(clinicDiv);
        }

        window.addClinic = function() {
            const newIndex = defaultClinics.length;
            defaultClinics.push({ name: `Ø¹ÙŠØ§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© ${newIndex + 1}`, number: newIndex + 1 });
            addClinicToDOM(defaultClinics[newIndex], newIndex);
        };

        window.updateClinic = function(index, field, value) {
            defaultClinics[index][field] = field === 'number' ? parseInt(value) : value;
        };

        window.removeClinic = function(index) {
            defaultClinics.splice(index, 1);
            initializeClinics();
        };

        window.initializeDatabase = async function() {
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');

            // Show progress
            progressSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                // Get Firebase configuration
                const config = {
                    apiKey: document.getElementById('apiKey').value,
                    authDomain: document.getElementById('authDomain').value,
                    databaseURL: document.getElementById('databaseURL').value,
                    projectId: document.getElementById('projectId').value,
                };

                if (!config.apiKey || !config.authDomain || !config.databaseURL || !config.projectId) {
                    throw new Error('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Firebase');
                }

                // Initialize Firebase
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase...';
                progressBar.style.width = '20%';
                
                app = initializeApp(config);
                auth = getAuth(app);
                database = getDatabase(app);
                firestore = getFirestore(app);

                // Create system settings
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…...';
                progressBar.style.width = '40%';

                const centerName = document.getElementById('centerName').value;
                const screenCount = parseInt(document.getElementById('screenCount').value);
                const screenPassword = document.getElementById('screenPassword').value;
                const controlPassword = document.getElementById('controlPassword').value;

                await set(ref(database, 'settings'), {
                    centerName,
                    screenCount,
                    screenPassword,
                    controlPassword,
                    createdAt: new Date().toISOString(),
                    newsTicker: 'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©',
                    alertDuration: 5,
                    speechRate: 1,
                    audioPath: './audio',
                    mediaPath: './media',
                    instantPath: './instant'
                });

                // Create screens
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø§Øª...';
                progressBar.style.width = '60%';

                for (let i = 1; i <= screenCount; i++) {
                    await set(ref(database, `screens/${i}`), {
                        id: i,
                        name: `Ø´Ø§Ø´Ø© ${i}`,
                        password: screenPassword,
                        isActive: true,
                        currentClinics: defaultClinics.slice(0, 4).map(c => c.number),
                        createdAt: new Date().toISOString()
                    });
                }

                // Create clinics
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª...';
                progressBar.style.width = '80%';

                for (const clinic of defaultClinics) {
                    await set(ref(database, `clinics/${clinic.number}`), {
                        number: clinic.number,
                        name: clinic.name,
                        currentNumber: 0,
                        lastCalled: null,
                        isActive: true,
                        screenId: Math.ceil(clinic.number / 4),
                        createdAt: new Date().toISOString()
                    });
                }

                // Create default admin user
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±...';
                progressBar.style.width = '90%';

                const adminEmail = 'admin@center.com';
                const adminPassword = 'admin123';
                
                try {
                    const adminCredential = await createUserWithEmailAndPassword(auth, adminEmail, adminPassword);
                    await setDoc(doc(firestore, 'users', adminCredential.user.uid), {
                        email: adminEmail,
                        role: 'admin',
                        name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                        createdAt: new Date().toISOString()
                    });
                } catch (error) {
                    console.log('Admin user might already exist');
                }

                // Complete
                progressText.textContent = 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!';
                progressBar.style.width = '100%';

                // Show results
                resultsContent.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                        <h3 class="font-bold text-green-800 mb-2">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</h3>
                        <ul class="text-green-700 space-y-1">
                            <li>â€¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…: ${centerName}</li>
                            <li>â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§Ø´Ø§Øª: ${screenCount}</li>
                            <li>â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ${defaultClinics.length}</li>
                            <li>â€¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±: ${adminEmail} / ${adminPassword}</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-bold text-blue-800 mb-2">ğŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
                        <ol class="text-blue-700 space-y-1">
                            <li>1. Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
                            <li>2. Ø£Ù†Ø´Ø¦ Ù…Ù„Ù config.js ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</li>
                            <li>3. Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ config.js</li>
                            <li>4. Ù‚Ù… Ø¨Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ GitHub Pages</li>
                        </ol>
                    </div>
                `;

                setTimeout(() => {
                    progressSection.classList.add('hidden');
                    resultsSection.classList.remove('hidden');
                }, 1000);

            } catch (error) {
                progressText.textContent = `Ø®Ø·Ø£: ${error.message}`;
                progressText.className = 'text-center text-red-600';
            }
        };

        window.downloadConfig = function() {
            const config = {
                apiKey: document.getElementById('apiKey').value || "YOUR_API_KEY",
                authDomain: document.getElementById('authDomain').value || "YOUR_AUTH_DOMAIN",
                databaseURL: document.getElementById('databaseURL').value || "YOUR_DATABASE_URL",
                projectId: document.getElementById('projectId').value || "YOUR_PROJECT_ID",
            };

            const configContent = `// Firebase Configuration
const firebaseConfig = ${JSON.stringify(config, null, 2)};

// System Settings
const systemSettings = {
    centerName: "${document.getElementById('centerName').value}",
    screenCount: ${document.getElementById('screenCount').value},
    screenPassword: "${document.getElementById('screenPassword').value}",
    controlPassword: "${document.getElementById('controlPassword').value}",
    defaultClinics: ${JSON.stringify(defaultClinics, null, 2)}
};

// Export for use in other files
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { firebaseConfig, systemSettings };
}`;

            const blob = new Blob([configContent], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        // Initialize clinics on load
        initializeClinics();
    </script>
</body>
</html>