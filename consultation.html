<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاستشارات الطبية - نظام إدارة الانتظار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .step { transition: all 0.3s ease; }
        .step.active { border-color: #8b5cf6; background-color: #f3e8ff; }
        .step.completed { border-color: #10b981; background-color: #ecfdf5; }
        .consultation-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .consultation-card.unread { border-left-color: #8b5cf6; }
        .consultation-card.urgent { border-left-color: #ef4444; }
        .consultation-card.normal { border-left-color: #10b981; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Header -->
    <header class="bg-white/10 backdrop-blur-sm border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-comments text-2xl text-white ml-3"></i>
                    <div>
                        <h1 class="text-xl font-bold text-white">الاستشارات الطبية</h1>
                        <p class="text-white/80 text-sm">استشارات طبية أونلاين</p>
                    </div>
                </div>
                <div class="text-left">
                    <div class="text-white font-semibold" id="currentTime"></div>
                    <div class="text-white/80 text-sm" id="currentDate"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Registration Section -->
        <div id="registrationSection" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <div class="text-center mb-8">
                    <i class="fas fa-user-plus text-6xl text-purple-600 mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">التسجيل للاستشارات</h2>
                    <p class="text-gray-600">سجل بياناتك الطبية للحصول على استشارات طبية أونلاين</p>
                </div>

                <!-- Progress Steps -->
                <div class="flex items-center justify-center mb-8">
                    <div class="flex items-center space-x-4">
                        <div class="step active flex items-center justify-center w-10 h-10 rounded-full border-2 border-purple-500 text-purple-600 font-bold">1</div>
                        <div class="w-16 h-1 bg-gray-300"></div>
                        <div class="step flex items-center justify-center w-10 h-10 rounded-full border-2 border-gray-300 text-gray-400 font-bold">2</div>
                        <div class="w-16 h-1 bg-gray-300"></div>
                        <div class="step flex items-center justify-center w-10 h-10 rounded-full border-2 border-gray-300 text-gray-400 font-bold">3</div>
                    </div>
                </div>

                <!-- Registration Form -->
                <form id="registrationForm">
                    <!-- Step 1: Personal Information -->
                    <div id="step1" class="registration-step">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-user text-purple-600 ml-3"></i>
                            المعلومات الشخصية
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الاسم الرباعي *</label>
                                <input type="text" id="fullName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required maxlength="50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الرقم القومي *</label>
                                <input type="text" id="nationalId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required maxlength="14">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">رقم التليفون *</label>
                                <input type="tel" id="phoneNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required maxlength="11">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">البريد الإلكتروني *</label>
                                <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">النوع *</label>
                                <select id="gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    <option value="">اختر النوع</option>
                                    <option value="male">ذكر</option>
                                    <option value="female">أنثى</option>
                                    <option value="child">طفل</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">عدد أفراد الأسرة</label>
                                <input type="number" id="familySize" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" min="0" max="10">
                            </div>
                        </div>

                        <div class="flex justify-end">
                            <button type="button" onclick="nextStep(2)" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                                التالي <i class="fas fa-arrow-left ml-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Medical History -->
                    <div id="step2" class="registration-step hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-heartbeat text-purple-600 ml-3"></i>
                            التاريخ المرضي
                        </h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">الأمراض المزمنة (اختر كل ما ينطبق)</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="diabetes" class="mr-2">
                                        <span class="text-sm">سكر</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="hypertension" class="mr-2">
                                        <span class="text-sm">ضغط</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="cancer" class="mr-2">
                                        <span class="text-sm">أورام</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="liver" class="mr-2">
                                        <span class="text-sm">كبد</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="kidney" class="mr-2">
                                        <span class="text-sm">كلى</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="chronicDiseases" value="other" class="mr-2">
                                        <span class="text-sm">أخرى</span>
                                    </label>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">حدوث حمل</label>
                                    <select id="pregnancy" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">اختر</option>
                                        <option value="yes">نعم</option>
                                        <option value="no">لا</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">رضاعة طبيعية</label>
                                    <select id="breastfeeding" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">اختر</option>
                                        <option value="yes">نعم</option>
                                        <option value="no">لا</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">عمليات سابقة</label>
                                    <select id="surgeries" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">اختر</option>
                                        <option value="yes">نعم</option>
                                        <option value="no">لا</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">حساسية من أدوية</label>
                                    <select id="drugAllergies" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">اختر</option>
                                        <option value="yes">نعم</option>
                                        <option value="no">لا</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">أدوية حالية</label>
                                    <select id="currentMedications" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">اختر</option>
                                        <option value="yes">نعم</option>
                                        <option value="no">لا</option>
                                    </select>
                                </div>
                            </div>

                            <div id="additionalInfo" class="hidden space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">تفاصيل العمليات السابقة</label>
                                    <textarea id="surgeryDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="وصف العمليات السابقة..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">تفاصيل الحساسية</label>
                                    <textarea id="allergyDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="أي أدوية تسبب حساسية..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">الأدوية الحالية</label>
                                    <textarea id="medicationDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="قائمة الأدوية الحالية..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between mt-8">
                            <button type="button" onclick="previousStep(1)" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                                <i class="fas fa-arrow-right ml-2"></i>السابق
                            </button>
                            <button type="button" onclick="nextStep(3)" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                                التالي <i class="fas fa-arrow-left ml-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Physical Information -->
                    <div id="step3" class="registration-step hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-ruler text-purple-600 ml-3"></i>
                            المعلومات الفسيولوجية
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الوزن (كجم)</label>
                                <input type="number" id="weight" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" min="1" max="300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الطول (سم)</label>
                                <input type="number" id="height" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" min="50" max="250">
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="font-bold text-gray-700 mb-4">العلامات الحيوية (إن وجدت)</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ضغط الدم</label>
                                    <input type="text" id="bloodPressure" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="120/80">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">درجة الحرارة</label>
                                    <input type="number" id="temperature" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="37.0" step="0.1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">النبض</label>
                                    <input type="number" id="pulse" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="72">
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">الأعراض الحالية</label>
                            <textarea id="currentSymptoms" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="وصف الأعراض التي تعاني منها حالياً..."></textarea>
                        </div>

                        <div class="flex justify-between">
                            <button type="button" onclick="previousStep(2)" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                                <i class="fas fa-arrow-right ml-2"></i>السابق
                            </button>
                            <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                                <i class="fas fa-save ml-2"></i>حفظ وإكمال
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Consultations List Section -->
        <div id="consultationsSection" class="max-w-6xl mx-auto hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Filters Sidebar -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-filter text-purple-600 ml-3"></i>
                            تصفية الاستشارات
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">حالة الاستشارة</label>
                                <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">الكل</option>
                                    <option value="open">مفتوحة</option>
                                    <option value="closed">مغلقة</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الأولوية</label>
                                <select id="priorityFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">الكل</option>
                                    <option value="urgent">عاجل</option>
                                    <option value="normal">عادي</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">التخصص</label>
                                <select id="specialtyFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">الكل</option>
                                    <option value="family">طب أسرة</option>
                                    <option value="internal">باطنة</option>
                                    <option value="pediatric">أطفال</option>
                                    <option value="gynecology">نساء</option>
                                    <option value="dermatology">جلدية</option>
                                </select>
                            </div>
                            
                            <button onclick="applyFilters()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition-colors">
                                <i class="fas fa-search ml-2"></i>تطبيق
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">إحصائيات سريعة</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">إجمالي الاستشارات</span>
                                <span class="font-bold" id="totalConsultations">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">مفتوحة</span>
                                <span class="font-bold text-green-600" id="openConsultations">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">مغلقة</span>
                                <span class="font-bold text-gray-600" id="closedConsultations">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">عاجلة</span>
                                <span class="font-bold text-red-600" id="urgentConsultations">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consultations List -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-800">الاستشارات الواردة</h3>
                            <div class="flex items-center space-x-2">
                                <button onclick="refreshConsultations()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    <i class="fas fa-refresh ml-2"></i>تحديث
                                </button>
                            </div>
                        </div>
                        
                        <div id="consultationsList" class="space-y-4">
                            <!-- Consultations will be loaded here -->
                        </div>
                        
                        <div id="noConsultations" class="text-center py-12 hidden">
                            <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-600 mb-2">لا توجد استشارات</h3>
                            <p class="text-gray-500">لا توجد استشارات مطابقة للمعايير المحددة</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Consultation Details Modal -->
        <div id="consultationModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-800">تفاصيل الاستشارة</h2>
                        <button onclick="closeConsultationModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="consultationDetails">
                        <!-- Consultation details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase configuration
 // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCpgAJGWXAPN87CfBHI7cxA44NHjpSeOI4",
  authDomain: "queue3-1c1a4.firebaseapp.com",
  databaseURL: "https://queue3-1c1a4-default-rtdb.firebaseio.com",
  projectId: "queue3-1c1a4",
  storageBucket: "queue3-1c1a4.firebasestorage.app",
  messagingSenderId: "766611607574",
  appId: "1:766611607574:web:c0ee754f7324adc853a537",
  measurementId: "G-ZSZ13TYJQW"
};

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentStep = 1;
        let patientData = {};
        let consultations = [];

        // Form validation and step navigation
        function validateStep(step) {
            switch(step) {
                case 1:
                    return document.getElementById('fullName').value &&
                           document.getElementById('nationalId').value &&
                           document.getElementById('phoneNumber').value &&
                           document.getElementById('email').value &&
                           document.getElementById('gender').value;
                case 2:
                    return true; // Optional fields
                case 3:
                    return true; // Optional fields
                default:
                    return false;
            }
        }

        window.nextStep = function(step) {
            if (validateStep(currentStep)) {
                document.getElementById(`step${currentStep}`).classList.add('hidden');
                document.querySelectorAll('.step')[currentStep - 1].classList.remove('active');
                document.querySelectorAll('.step')[currentStep - 1].classList.add('completed');
                
                currentStep = step;
                document.getElementById(`step${step}`).classList.remove('hidden');
                document.querySelectorAll('.step')[step - 1].classList.add('active');
            } else {
                alert('يرجى إكمال جميع الحقول المطلوبة');
            }
        };

        window.previousStep = function(step) {
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.querySelectorAll('.step')[currentStep - 1].classList.remove('active');
            
            currentStep = step;
            document.getElementById(`step${step}`).classList.remove('hidden');
            document.querySelectorAll('.step')[step - 1].classList.remove('completed');
            document.querySelectorAll('.step')[step - 1].classList.add('active');
        };

        // Show/hide additional info based on selections
        document.addEventListener('change', function(e) {
            if (e.target.id === 'surgeries' || e.target.id === 'drugAllergies' || e.target.id === 'currentMedications') {
                const surgeries = document.getElementById('surgeries').value;
                const allergies = document.getElementById('drugAllergies').value;
                const medications = document.getElementById('currentMedications').value;
                
                const additionalInfo = document.getElementById('additionalInfo');
                if (surgeries === 'yes' || allergies === 'yes' || medications === 'yes') {
                    additionalInfo.classList.remove('hidden');
                } else {
                    additionalInfo.classList.add('hidden');
                }
            }
        });

        // Registration form submission
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect all form data
            patientData = {
                fullName: document.getElementById('fullName').value,
                nationalId: document.getElementById('nationalId').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                email: document.getElementById('email').value,
                gender: document.getElementById('gender').value,
                familySize: document.getElementById('familySize').value,
                chronicDiseases: Array.from(document.querySelectorAll('input[name="chronicDiseases"]:checked')).map(cb => cb.value),
                pregnancy: document.getElementById('pregnancy').value,
                breastfeeding: document.getElementById('breastfeeding').value,
                surgeries: document.getElementById('surgeries').value,
                surgeryDetails: document.getElementById('surgeryDetails')?.value,
                drugAllergies: document.getElementById('drugAllergies').value,
                allergyDetails: document.getElementById('allergyDetails')?.value,
                currentMedications: document.getElementById('currentMedications').value,
                medicationDetails: document.getElementById('medicationDetails')?.value,
                weight: document.getElementById('weight').value,
                height: document.getElementById('height').value,
                bloodPressure: document.getElementById('bloodPressure').value,
                temperature: document.getElementById('temperature').value,
                pulse: document.getElementById('pulse').value,
                currentSymptoms: document.getElementById('currentSymptoms').value,
                timestamp: new Date().toISOString(),
                status: 'active'
            };
            
            try {
                // Save patient data
                const patientsRef = ref(database, 'patients');
                await push(patientsRef, patientData);
                
                // Show success message and switch to consultations
                alert('تم التسجيل بنجاح! يمكنك الآن إرسال استشارتك.');
                showConsultationsSection();
                
            } catch (error) {
                alert('خطأ في التسجيل: ' + error.message);
            }
        });

        function showConsultationsSection() {
            document.getElementById('registrationSection').classList.add('hidden');
            document.getElementById('consultationsSection').classList.remove('hidden');
            loadConsultations();
        }

        function loadConsultations() {
            // Mock consultations data
            consultations = [
                {
                    id: 1,
                    patientName: 'أحمد خالد',
                    nationalId: '12345678901234',
                    phoneNumber: '01234567890',
                    email: 'ahmed@example.com',
                    specialty: 'family',
                    complaint: 'صداع مستمر',
                    symptoms: 'أعاني من صداع مستمر منذ أسبوع مع دوخة أحياناً',
                    priority: 'urgent',
                    status: 'open',
                    weight: '75',
                    height: '170',
                    bloodPressure: '120/80',
                    temperature: '37.2',
                    pulse: '78',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 2,
                    patientName: 'فاطمة علي',
                    nationalId: '98765432109876',
                    phoneNumber: '01123456789',
                    email: 'fatima@example.com',
                    specialty: 'gynecology',
                    complaint: 'استشارة نسائية',
                    symptoms: 'أود استشارة حول بعض الأعراض التي أعاني منها',
                    priority: 'normal',
                    status: 'open',
                    weight: '65',
                    height: '160',
                    bloodPressure: '110/70',
                    temperature: '36.8',
                    pulse: '72',
                    timestamp: new Date().toISOString()
                }
            ];
            
            displayConsultations(consultations);
            updateStatistics();
        }

        function displayConsultations(consultationsList) {
            const container = document.getElementById('consultationsList');
            const noData = document.getElementById('noConsultations');
            
            if (consultationsList.length === 0) {
                container.innerHTML = '';
                noData.classList.remove('hidden');
                return;
            }
            
            noData.classList.add('hidden');
            container.innerHTML = '';
            
            consultationsList.forEach(consultation => {
                const card = createConsultationCard(consultation);
                container.appendChild(card);
            });
        }

        function createConsultationCard(consultation) {
            const card = document.createElement('div');
            card.className = `consultation-card bg-white rounded-lg border p-4 ${consultation.priority} ${consultation.status}`;
            
            const timeAgo = getTimeAgo(new Date(consultation.timestamp));
            const specialtyNames = {
                'family': 'طب أسرة',
                'internal': 'باطنة',
                'pediatric': 'أطفال',
                'gynecology': 'نساء',
                'dermatology': 'جلدية'
            };
            
            card.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-user text-purple-600"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-800">${consultation.patientName}</div>
                            <div class="text-sm text-gray-600">${consultation.nationalId}</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-2 py-1 rounded text-xs ${consultation.status === 'open' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                            ${consultation.status === 'open' ? 'مفتوحة' : 'مغلقة'}
                        </span>
                        <span class="px-2 py-1 rounded text-xs ${consultation.priority === 'urgent' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                            ${consultation.priority === 'urgent' ? 'عاجل' : 'عادي'}
                        </span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">${specialtyNames[consultation.specialty]}</span>
                        <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">${consultation.complaint}</span>
                    </div>
                    <p class="text-gray-700 text-sm">${consultation.symptoms}</p>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="text-xs text-gray-500">${timeAgo}</div>
                    <div class="flex space-x-2">
                        <button onclick="viewConsultation(${consultation.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-eye ml-1"></i>عرض
                        </button>
                        ${consultation.status === 'open' ? `
                            <button onclick="replyToConsultation(${consultation.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                <i class="fas fa-reply ml-1"></i>رد
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return card;
        }

        function updateStatistics() {
            const total = consultations.length;
            const open = consultations.filter(c => c.status === 'open').length;
            const closed = consultations.filter(c => c.status === 'closed').length;
            const urgent = consultations.filter(c => c.priority === 'urgent').length;
            
            document.getElementById('totalConsultations').textContent = total;
            document.getElementById('openConsultations').textContent = open;
            document.getElementById('closedConsultations').textContent = closed;
            document.getElementById('urgentConsultations').textContent = urgent;
        }

        window.applyFilters = function() {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const specialtyFilter = document.getElementById('specialtyFilter').value;
            
            let filtered = consultations.filter(consultation => {
                if (statusFilter && consultation.status !== statusFilter) return false;
                if (priorityFilter && consultation.priority !== priorityFilter) return false;
                if (specialtyFilter && consultation.specialty !== specialtyFilter) return false;
                return true;
            });
            
            displayConsultations(filtered);
        };

        window.refreshConsultations = function() {
            loadConsultations();
        };

        window.viewConsultation = function(id) {
            const consultation = consultations.find(c => c.id === id);
            if (consultation) {
                showConsultationDetails(consultation);
            }
        };

        function showConsultationDetails(consultation) {
            const modal = document.getElementById('consultationModal');
            const details = document.getElementById('consultationDetails');
            
            const specialtyNames = {
                'family': 'طب أسرة',
                'internal': 'باطنة',
                'pediatric': 'أطفال',
                'gynecology': 'نساء',
                'dermatology': 'جلدية'
            };
            
            details.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h4 class="font-bold text-gray-800 mb-3">المعلومات الشخصية</h4>
                        <div class="space-y-2">
                            <div><span class="font-medium">الاسم:</span> ${consultation.patientName}</div>
                            <div><span class="font-medium">الرقم القومي:</span> ${consultation.nationalId}</div>
                            <div><span class="font-medium">رقم التليفون:</span> ${consultation.phoneNumber}</div>
                            <div><span class="font-medium">البريد الإلكتروني:</span> ${consultation.email}</div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-3">المعلومات الطبية</h4>
                        <div class="space-y-2">
                            <div><span class="font-medium">التخصص:</span> ${specialtyNames[consultation.specialty]}</div>
                            <div><span class="font-medium">الشكوى:</span> ${consultation.complaint}</div>
                            <div><span class="font-medium">الأعراض:</span> ${consultation.symptoms}</div>
                            <div><span class="font-medium">الأولوية:</span> ${consultation.priority === 'urgent' ? 'عاجل' : 'عادي'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-50 p-3 rounded-lg text-center">
                        <div class="text-sm text-gray-600">الوزن</div>
                        <div class="font-bold">${consultation.weight} كجم</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg text-center">
                        <div class="text-sm text-gray-600">الطول</div>
                        <div class="font-bold">${consultation.height} سم</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg text-center">
                        <div class="text-sm text-gray-600">ضغط الدم</div>
                        <div class="font-bold">${consultation.bloodPressure}</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg text-center">
                        <div class="text-sm text-gray-600">النبض</div>
                        <div class="font-bold">${consultation.pulse} نبضة/دقيقة</div>
                    </div>
                </div>
                
                <div class="border-t pt-6">
                    <h4 class="font-bold text-gray-800 mb-3">الرد على الاستشارة</h4>
                    <textarea id="consultationReply" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="اكتب ردك على الاستشارة..."></textarea>
                    <div class="flex justify-end mt-4">
                        <button onclick="sendReply(${consultation.id})" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-paper-plane ml-2"></i>إرسال الرد
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        window.closeConsultationModal = function() {
            const modal = document.getElementById('consultationModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        window.sendReply = function(consultationId) {
            const reply = document.getElementById('consultationReply').value;
            if (!reply.trim()) {
                alert('يرجى كتابة الرد');
                return;
            }
            
            const replyData = {
                consultationId: consultationId,
                reply: reply,
                doctorId: 'current-doctor-id', // This would be the actual doctor ID
                timestamp: new Date().toISOString()
            };
            
            const repliesRef = ref(database, 'consultationReplies');
            push(repliesRef, replyData)
                .then(() => {
                    // Update consultation status
                    const consultationRef = ref(database, `consultations/${consultationId}/status`);
                    set(consultationRef, 'closed');
                    
                    alert('تم إرسال الرد بنجاح');
                    closeConsultationModal();
                    refreshConsultations();
                })
                .catch(error => {
                    alert('خطأ في إرسال الرد: ' + error.message);
                });
        };

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'منذ ثواني';
            if (diffInSeconds < 3600) return `منذ ${Math.floor(diffInSeconds / 60)} دقيقة`;
            if (diffInSeconds < 86400) return `منذ ${Math.floor(diffInSeconds / 3600)} ساعة`;
            return `منذ ${Math.floor(diffInSeconds / 86400)} يوم`;
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('ar-EG');
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Initialize
        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>
</body>
</html>
